{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Warning: Packages pyspark or cern.nxcals are not installed. Data retrieval from NXCALS is not possible.\n",
      " If you are on SWAN and did not expect this warning, then restart and load the 'NXCals Pro' software stack.\n",
      "No pytransport functionality\n",
      "No pytransport functionality\n"
     ]
    }
   ],
   "source": [
    "import sys \n",
    "import pathlib\n",
    "import os\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "#sys.path.append(os.path.abspath(\"/eos/home-b/bjlindst/SWAN_projects/lib\"))\n",
    "#import twissParser as tp\n",
    "#import lossMapTools as lmt\n",
    "import matplotlib.pyplot as plt\n",
    "import matplotlib.font_manager as font_manager\n",
    "import lossmaps as lm\n",
    "import pickle\n",
    "np.set_printoptions(linewidth=100)\n",
    "import scipy\n",
    "\n",
    "import json\n",
    "import numpy as np\n",
    "from pathlib import Path\n",
    "import sys\n",
    "import os\n",
    "import yaml\n",
    "\n",
    "import xobjects as xo\n",
    "import xtrack as xt\n",
    "import xpart as xp\n",
    "import xcoll as xc\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Loading"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "beam          = 2   #run_dict['beam']\n",
    "plane         = \"V\" #run_dict['plane']\n",
    "TCCS_name     = 'tccs.5r3.b2'\n",
    "TCCP_name     = 'tccp.4l3.b2'\n",
    "TARGET_name   = 'target.4l3.b2'\n",
    "TCLA_name     = 'tcla.a5l3.b2'\n",
    "TCP_name      = f\"tcp.{'c' if plane=='H' else 'd'}6{'l' if beam=='1' else 'r'}7.b{beam}\"\n",
    "context = xo.ContextCpu(omp_num_threads='auto')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "coll_file_RUN3 = os.path.expandvars('${HOME_TWOCRYST}/input_files/flat_top.yaml')\n",
    "line_name_RUN3 = os.path.expandvars(\"${HOME_TWOCRYST}/input_files/flat_top_b2.json\")\n",
    "particle_ref_RUN3 = xp.Particles(p0c=6800e9, q0=1, mass0=xp.PROTON_MASS_EV)\n",
    "coll_file_HL= os.path.expandvars('${HOME_TWOCRYST}/input_files/CollDB_HL_tight_b4.data')\n",
    "line_name_HL_IR7 = os.path.expandvars(\"${HOME_TWOCRYST}/input_files/HL_IR7_rematched/b4_sequence_patched.json\")\n",
    "particle_ref_HL = xp.Particles(p0c=7000e9, q0=1, mass0=xp.PROTON_MASS_EV)\n",
    "line_name_HL_IR7_IR3 = os.path.expandvars(\"${HOME_TWOCRYST}/input_files/HL_IR7_IR3_rematched/b4_sequence_patched.json\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "import io\n",
    "\n",
    "def load_colldb_new(filename):\n",
    "    with open(filename, \"r\") as infile:\n",
    "        coll_data_string = \"\"\n",
    "        family_settings = {}\n",
    "        family_types = {}\n",
    "        onesided = {}\n",
    "        tilted = {}\n",
    "        bend = {}\n",
    "        xdim = {}\n",
    "        ydim = {}\n",
    "\n",
    "        for l_no, line in enumerate(infile):\n",
    "            if line.startswith(\"#\"):\n",
    "                continue  # Comment\n",
    "            if len(line.strip()) == 0:\n",
    "                continue  # Empty line\n",
    "            sline = line.split()\n",
    "            if len(sline) < 6 or sline[0].lower() == \"crystal\" or sline[0].lower() == \"target\":\n",
    "                if sline[0].lower() == \"nsig_fam\":\n",
    "                    family_settings[sline[1]] = sline[2]\n",
    "                    family_types[sline[1]] = sline[3]\n",
    "                elif sline[0].lower() == \"onesided\":\n",
    "                    onesided[sline[1]] = int(sline[2])\n",
    "                elif sline[0].lower() == \"tilted\":\n",
    "                    tilted[sline[1]] = [float(sline[2]), float(sline[3])]\n",
    "                elif sline[0].lower() == \"crystal\":\n",
    "                    bend[sline[1]] = float(sline[2])\n",
    "                    xdim[sline[1]] = float(sline[3])\n",
    "                    ydim[sline[1]] = float(sline[4])\n",
    "                elif sline[0].lower() == \"target\":\n",
    "                    xdim[sline[1]] = float(sline[2])\n",
    "                    ydim[sline[1]] = float(sline[3])\n",
    "                elif sline[0].lower() == \"settings\":\n",
    "                    pass  # Acknowledge and ignore this line\n",
    "                else:\n",
    "                    raise ValueError(f\"Unknown setting {line}\")\n",
    "            else:\n",
    "                coll_data_string += line\n",
    "\n",
    "    names = [\"name\", \"opening\", \"material\", \"length\", \"angle\", \"offset\"]\n",
    "\n",
    "    df = pd.read_csv(io.StringIO(coll_data_string), delim_whitespace=True,\n",
    "                     index_col=False, skip_blank_lines=True, names=names)\n",
    "\n",
    "    df[\"angle\"] = df[\"angle\"] \n",
    "    df[\"name\"] = df[\"name\"].str.lower() # Make the names lowercase for easy processing\n",
    "    df[\"nsigma\"] = df[\"opening\"].apply(lambda s: float(family_settings.get(s, s)))\n",
    "    df[\"type\"] = df[\"opening\"].apply(lambda s: family_types.get(s, \"UNKNOWN\"))\n",
    "    df[\"side\"] = df[\"name\"].apply(lambda s: onesided.get(s, 0))\n",
    "    df[\"bend\"] = df[\"name\"].apply(lambda s: bend.get(s, 0))\n",
    "    df[\"xdim\"] = df[\"name\"].apply(lambda s: xdim.get(s, 0))\n",
    "    df[\"ydim\"] = df[\"name\"].apply(lambda s: ydim.get(s, 0))\n",
    "    df[\"tilt_left\"] = df[\"name\"].apply(lambda s: np.deg2rad(tilted.get(s, [0, 0])[0]))\n",
    "    df[\"tilt_right\"] = df[\"name\"].apply(lambda s: np.deg2rad(tilted.get(s, [0, 0])[1]))\n",
    "    df = df.set_index(\"name\").T\n",
    "\n",
    "    # Ensure the collimators marked as one-sided or tilted are actually defined\n",
    "    defined_set = set(df.columns) # The data fram was transposed so columns are names\n",
    "    onesided_set = set(onesided.keys())\n",
    "    tilted_set = set(tilted.keys())\n",
    "    if not onesided_set.issubset(defined_set):\n",
    "        different = onesided_set - defined_set\n",
    "        raise SystemExit('One-sided collimators not defined: {}'.format(\", \".join(different)))\n",
    "    if not tilted_set.issubset(defined_set):\n",
    "        different = tilted_set - defined_set\n",
    "        raise SystemExit('Tilted collimators not defined: {}'.format(\",\".join(different)))\n",
    "    return df.T"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "df = load_colldb_new(coll_file_HL)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "#df['angle_deg'] = df['angle']*180/np.pi\n",
    "#df.sort_values('opening')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "colldb_test_SixTrack= xc.CollimatorDatabase.from_SixTrack(coll_file_HL, nemitt_y=2.5e-6, nemitt_x=2.5e-6, ignore_crystals=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Index(['material', 'active_length', 'stage', 'offset', 'parking', 'bend',\n",
       "       'xdim', 'ydim', 'miscut', 'thick', 'side', 'crystal', 'family', 'gap_L',\n",
       "       'gap_R', 'angle_L', 'angle_R', 's_center', 'align_to', 's_align_front',\n",
       "       's_align_back', 'jaw_LU', 'jaw_RU', 'jaw_LD', 'jaw_RD',\n",
       "       'overwritten_keys', 'collimator_type', 'active', 'inactive_front',\n",
       "       'inactive_back', 'sigmax', 'sigmay'],\n",
       "      dtype='object')"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "colldb_test_SixTrack._colldb.keys()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>crystal</th>\n",
       "      <th>stage</th>\n",
       "      <th>material</th>\n",
       "      <th>active</th>\n",
       "      <th>xdim</th>\n",
       "      <th>ydim</th>\n",
       "      <th>gap_R</th>\n",
       "      <th>gap_L</th>\n",
       "      <th>thick</th>\n",
       "      <th>miscut</th>\n",
       "      <th>bend</th>\n",
       "      <th>side</th>\n",
       "      <th>family</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>tclpx.4l1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcl.5l1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcl.6l1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctph.4r2.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>43.8</td>\n",
       "      <td>43.8</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpv.4r2.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>43.8</td>\n",
       "      <td>43.8</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tdisa.a4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tdisb.a4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tdisc.a4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tclia.4r2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tclib.6l8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcld.a11l2.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcp.6r3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>primary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>17.7</td>\n",
       "      <td>17.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.5r3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>21.3</td>\n",
       "      <td>21.3</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.4l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>21.3</td>\n",
       "      <td>21.3</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.a5l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>21.3</td>\n",
       "      <td>21.3</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.b5l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>21.3</td>\n",
       "      <td>21.3</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.a5l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23.7</td>\n",
       "      <td>23.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.b5l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23.7</td>\n",
       "      <td>23.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.6l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23.7</td>\n",
       "      <td>23.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.7l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23.7</td>\n",
       "      <td>23.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctph.6r5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpv.6r5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpxh.4r5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpxv.4r5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tclpx.4l5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcl.5l5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcl.6l5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcdqa.a4l6.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>10.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>left</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcdqa.c4l6.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>10.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>left</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcdqa.b4l6.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>10.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>left</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsp.a4l6.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>10.1</td>\n",
       "      <td>10.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcp.d6r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>primary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>6.7</td>\n",
       "      <td>6.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcp.c6r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>primary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>6.7</td>\n",
       "      <td>6.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcp.b6r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>primary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>6.7</td>\n",
       "      <td>6.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.a6r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.b5r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.a5r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.d4r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcspm.b4r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.a4r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.a4l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.b5l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.d5l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcspm.e5l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcspm.6l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>secondary</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.a6l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.7</td>\n",
       "      <td>12.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.b6l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.7</td>\n",
       "      <td>12.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.c6l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.7</td>\n",
       "      <td>12.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.d6l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.7</td>\n",
       "      <td>12.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.a7l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.7</td>\n",
       "      <td>12.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcld.9l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctph.4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>17.7</td>\n",
       "      <td>17.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpv.4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>17.7</td>\n",
       "      <td>17.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctph.6r1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpv.6r1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpxh.4r1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpxv.4r1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>tertiary</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tccs.5r3.b2</th>\n",
       "      <td>strip</td>\n",
       "      <td>special</td>\n",
       "      <td>si</td>\n",
       "      <td>True</td>\n",
       "      <td>0.002</td>\n",
       "      <td>0.035</td>\n",
       "      <td>None</td>\n",
       "      <td>7.2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>80.0</td>\n",
       "      <td>left</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tccp.4l3.b2</th>\n",
       "      <td>strip</td>\n",
       "      <td>special</td>\n",
       "      <td>si</td>\n",
       "      <td>True</td>\n",
       "      <td>0.002</td>\n",
       "      <td>0.004</td>\n",
       "      <td>None</td>\n",
       "      <td>15.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>left</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>target.4l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>special</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.002</td>\n",
       "      <td>0.004</td>\n",
       "      <td>None</td>\n",
       "      <td>15.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>left</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              crystal      stage material active   xdim   ydim gap_R gap_L  \\\n",
       "tclpx.4l1.b2     None   tertiary     iner   True    0.0    0.0  16.4  16.4   \n",
       "tcl.5l1.b2       None   tertiary       cu   True    0.0    0.0  16.4  16.4   \n",
       "tcl.6l1.b2       None   tertiary     iner   True    0.0    0.0  16.4  16.4   \n",
       "tctph.4r2.b2     None   tertiary     iner   True    0.0    0.0  43.8  43.8   \n",
       "tctpv.4r2.b2     None   tertiary     iner   True    0.0    0.0  43.8  43.8   \n",
       "tdisa.a4r8.b2    None   tertiary       cu   True    0.0    0.0  None  None   \n",
       "tdisb.a4r8.b2    None   tertiary       cu   True    0.0    0.0  None  None   \n",
       "tdisc.a4r8.b2    None   tertiary       cu   True    0.0    0.0  None  None   \n",
       "tclia.4r2        None   tertiary        c   True    0.0    0.0  None  None   \n",
       "tclib.6l8.b2     None   tertiary        c   True    0.0    0.0  None  None   \n",
       "tcld.a11l2.b2    None   tertiary     iner   True    0.0    0.0  None  None   \n",
       "tcp.6r3.b2       None    primary        c   True    0.0    0.0  17.7  17.7   \n",
       "tcsg.5r3.b2      None  secondary        c   True    0.0    0.0  21.3  21.3   \n",
       "tcsg.4l3.b2      None  secondary        c   True    0.0    0.0  21.3  21.3   \n",
       "tcsg.a5l3.b2     None  secondary        c   True    0.0    0.0  21.3  21.3   \n",
       "tcsg.b5l3.b2     None  secondary        c   True    0.0    0.0  21.3  21.3   \n",
       "tcla.a5l3.b2     None   tertiary     iner   True    0.0    0.0  23.7  23.7   \n",
       "tcla.b5l3.b2     None   tertiary     iner   True    0.0    0.0  23.7  23.7   \n",
       "tcla.6l3.b2      None   tertiary     iner   True    0.0    0.0  23.7  23.7   \n",
       "tcla.7l3.b2      None   tertiary     iner   True    0.0    0.0  23.7  23.7   \n",
       "tctph.6r5.b2     None   tertiary     iner   True    0.0    0.0  12.0  12.0   \n",
       "tctpv.6r5.b2     None   tertiary     iner   True    0.0    0.0  12.0  12.0   \n",
       "tctpxh.4r5.b2    None   tertiary     iner   True    0.0    0.0  12.0  12.0   \n",
       "tctpxv.4r5.b2    None   tertiary     iner   True    0.0    0.0  12.0  12.0   \n",
       "tclpx.4l5.b2     None   tertiary     iner   True    0.0    0.0  16.4  16.4   \n",
       "tcl.5l5.b2       None   tertiary       cu   True    0.0    0.0  16.4  16.4   \n",
       "tcl.6l5.b2       None   tertiary     iner   True    0.0    0.0  16.4  16.4   \n",
       "tcdqa.a4l6.b2    None   tertiary        c   True    0.0    0.0  None  10.1   \n",
       "tcdqa.c4l6.b2    None   tertiary        c   True    0.0    0.0  None  10.1   \n",
       "tcdqa.b4l6.b2    None   tertiary        c   True    0.0    0.0  None  10.1   \n",
       "tcsp.a4l6.b2     None  secondary        c   True    0.0    0.0  10.1  10.1   \n",
       "tcp.d6r7.b2      None    primary     mogr   True    0.0    0.0   6.7   6.7   \n",
       "tcp.c6r7.b2      None    primary     mogr   True    0.0    0.0   6.7   6.7   \n",
       "tcp.b6r7.b2      None    primary        c   True    0.0    0.0   6.7   6.7   \n",
       "tcsg.a6r7.b2     None  secondary        c   True    0.0    0.0   9.1   9.1   \n",
       "tcsg.b5r7.b2     None  secondary     mogr   True    0.0    0.0   9.1   9.1   \n",
       "tcsg.a5r7.b2     None  secondary        c   True    0.0    0.0   9.1   9.1   \n",
       "tcsg.d4r7.b2     None  secondary     mogr   True    0.0    0.0   9.1   9.1   \n",
       "tcspm.b4r7.b2    None  secondary     mogr   True    0.0    0.0   9.1   9.1   \n",
       "tcsg.a4r7.b2     None  secondary     mogr   True    0.0    0.0   9.1   9.1   \n",
       "tcsg.a4l7.b2     None  secondary     mogr   True    0.0    0.0   9.1   9.1   \n",
       "tcsg.b5l7.b2     None  secondary     mogr   True    0.0    0.0   9.1   9.1   \n",
       "tcsg.d5l7.b2     None  secondary     mogr   True    0.0    0.0   9.1   9.1   \n",
       "tcspm.e5l7.b2    None  secondary     mogr   True    0.0    0.0   9.1   9.1   \n",
       "tcspm.6l7.b2     None  secondary     mogr   True    0.0    0.0   9.1   9.1   \n",
       "tcla.a6l7.b2     None   tertiary     iner   True    0.0    0.0  12.7  12.7   \n",
       "tcla.b6l7.b2     None   tertiary     iner   True    0.0    0.0  12.7  12.7   \n",
       "tcla.c6l7.b2     None   tertiary     iner   True    0.0    0.0  12.7  12.7   \n",
       "tcla.d6l7.b2     None   tertiary     iner   True    0.0    0.0  12.7  12.7   \n",
       "tcla.a7l7.b2     None   tertiary     iner   True    0.0    0.0  12.7  12.7   \n",
       "tcld.9l7.b2      None   tertiary     iner   True    0.0    0.0  None  None   \n",
       "tctph.4r8.b2     None   tertiary     iner   True    0.0    0.0  17.7  17.7   \n",
       "tctpv.4r8.b2     None   tertiary     iner   True    0.0    0.0  17.7  17.7   \n",
       "tctph.6r1.b2     None   tertiary     iner   True    0.0    0.0  12.0  12.0   \n",
       "tctpv.6r1.b2     None   tertiary     iner   True    0.0    0.0  12.0  12.0   \n",
       "tctpxh.4r1.b2    None   tertiary     iner   True    0.0    0.0  12.0  12.0   \n",
       "tctpxv.4r1.b2    None   tertiary     iner   True    0.0    0.0  12.0  12.0   \n",
       "tccs.5r3.b2     strip    special       si   True  0.002  0.035  None   7.2   \n",
       "tccp.4l3.b2     strip    special       si   True  0.002  0.004  None  15.0   \n",
       "target.4l3.b2    None    special     iner   True  0.002  0.004  None  15.0   \n",
       "\n",
       "              thick miscut  bend  side family  \n",
       "tclpx.4l1.b2    0.0    0.0   0.0  both   None  \n",
       "tcl.5l1.b2      0.0    0.0   0.0  both   None  \n",
       "tcl.6l1.b2      0.0    0.0   0.0  both   None  \n",
       "tctph.4r2.b2    0.0    0.0   0.0  both   None  \n",
       "tctpv.4r2.b2    0.0    0.0   0.0  both   None  \n",
       "tdisa.a4r8.b2   0.0    0.0   0.0  both   None  \n",
       "tdisb.a4r8.b2   0.0    0.0   0.0  both   None  \n",
       "tdisc.a4r8.b2   0.0    0.0   0.0  both   None  \n",
       "tclia.4r2       0.0    0.0   0.0  both   None  \n",
       "tclib.6l8.b2    0.0    0.0   0.0  both   None  \n",
       "tcld.a11l2.b2   0.0    0.0   0.0  both   None  \n",
       "tcp.6r3.b2      0.0    0.0   0.0  both   None  \n",
       "tcsg.5r3.b2     0.0    0.0   0.0  both   None  \n",
       "tcsg.4l3.b2     0.0    0.0   0.0  both   None  \n",
       "tcsg.a5l3.b2    0.0    0.0   0.0  both   None  \n",
       "tcsg.b5l3.b2    0.0    0.0   0.0  both   None  \n",
       "tcla.a5l3.b2    0.0    0.0   0.0  both   None  \n",
       "tcla.b5l3.b2    0.0    0.0   0.0  both   None  \n",
       "tcla.6l3.b2     0.0    0.0   0.0  both   None  \n",
       "tcla.7l3.b2     0.0    0.0   0.0  both   None  \n",
       "tctph.6r5.b2    0.0    0.0   0.0  both   None  \n",
       "tctpv.6r5.b2    0.0    0.0   0.0  both   None  \n",
       "tctpxh.4r5.b2   0.0    0.0   0.0  both   None  \n",
       "tctpxv.4r5.b2   0.0    0.0   0.0  both   None  \n",
       "tclpx.4l5.b2    0.0    0.0   0.0  both   None  \n",
       "tcl.5l5.b2      0.0    0.0   0.0  both   None  \n",
       "tcl.6l5.b2      0.0    0.0   0.0  both   None  \n",
       "tcdqa.a4l6.b2   0.0    0.0   0.0  left   None  \n",
       "tcdqa.c4l6.b2   0.0    0.0   0.0  left   None  \n",
       "tcdqa.b4l6.b2   0.0    0.0   0.0  left   None  \n",
       "tcsp.a4l6.b2    0.0    0.0   0.0  both   None  \n",
       "tcp.d6r7.b2     0.0    0.0   0.0  both   None  \n",
       "tcp.c6r7.b2     0.0    0.0   0.0  both   None  \n",
       "tcp.b6r7.b2     0.0    0.0   0.0  both   None  \n",
       "tcsg.a6r7.b2    0.0    0.0   0.0  both   None  \n",
       "tcsg.b5r7.b2    0.0    0.0   0.0  both   None  \n",
       "tcsg.a5r7.b2    0.0    0.0   0.0  both   None  \n",
       "tcsg.d4r7.b2    0.0    0.0   0.0  both   None  \n",
       "tcspm.b4r7.b2   0.0    0.0   0.0  both   None  \n",
       "tcsg.a4r7.b2    0.0    0.0   0.0  both   None  \n",
       "tcsg.a4l7.b2    0.0    0.0   0.0  both   None  \n",
       "tcsg.b5l7.b2    0.0    0.0   0.0  both   None  \n",
       "tcsg.d5l7.b2    0.0    0.0   0.0  both   None  \n",
       "tcspm.e5l7.b2   0.0    0.0   0.0  both   None  \n",
       "tcspm.6l7.b2    0.0    0.0   0.0  both   None  \n",
       "tcla.a6l7.b2    0.0    0.0   0.0  both   None  \n",
       "tcla.b6l7.b2    0.0    0.0   0.0  both   None  \n",
       "tcla.c6l7.b2    0.0    0.0   0.0  both   None  \n",
       "tcla.d6l7.b2    0.0    0.0   0.0  both   None  \n",
       "tcla.a7l7.b2    0.0    0.0   0.0  both   None  \n",
       "tcld.9l7.b2     0.0    0.0   0.0  both   None  \n",
       "tctph.4r8.b2    0.0    0.0   0.0  both   None  \n",
       "tctpv.4r8.b2    0.0    0.0   0.0  both   None  \n",
       "tctph.6r1.b2    0.0    0.0   0.0  both   None  \n",
       "tctpv.6r1.b2    0.0    0.0   0.0  both   None  \n",
       "tctpxh.4r1.b2   0.0    0.0   0.0  both   None  \n",
       "tctpxv.4r1.b2   0.0    0.0   0.0  both   None  \n",
       "tccs.5r3.b2     0.0    0.0  80.0  left   None  \n",
       "tccp.4l3.b2     0.0    0.0  10.0  left   None  \n",
       "target.4l3.b2   0.0    0.0   0.0  left   None  "
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "colldb_test_SixTrack._colldb[['crystal','stage' ,'material', 'active', 'xdim', 'ydim', 'gap_R', 'gap_L', 'thick', 'miscut', 'bend', 'side', 'family']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [],
   "source": [
    "colldb_test_Yaml= xc.CollimatorDatabase.from_yaml(coll_file_RUN3, beam=2, ignore_crystals=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>crystal</th>\n",
       "      <th>material</th>\n",
       "      <th>active</th>\n",
       "      <th>xdim</th>\n",
       "      <th>ydim</th>\n",
       "      <th>gap_R</th>\n",
       "      <th>gap_L</th>\n",
       "      <th>thick</th>\n",
       "      <th>miscut</th>\n",
       "      <th>bend</th>\n",
       "      <th>side</th>\n",
       "      <th>family</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>tcl.4l1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>both</td>\n",
       "      <td>tcl4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcl.5l1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>both</td>\n",
       "      <td>tcl5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcl.6l1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>both</td>\n",
       "      <td>tcl6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctph.4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>both</td>\n",
       "      <td>tct8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpv.4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>both</td>\n",
       "      <td>tct8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctph.4r1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>both</td>\n",
       "      <td>tct15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpv.4r1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>both</td>\n",
       "      <td>tct15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tccs.5r3.b2</th>\n",
       "      <td>strip</td>\n",
       "      <td>si</td>\n",
       "      <td>True</td>\n",
       "      <td>0.002</td>\n",
       "      <td>0.035</td>\n",
       "      <td>None</td>\n",
       "      <td>5.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>80.0</td>\n",
       "      <td>left</td>\n",
       "      <td>tccs3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tccp.4l3.b2</th>\n",
       "      <td>strip</td>\n",
       "      <td>si</td>\n",
       "      <td>True</td>\n",
       "      <td>0.002</td>\n",
       "      <td>0.008</td>\n",
       "      <td>None</td>\n",
       "      <td>10</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>left</td>\n",
       "      <td>tccp3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>target.4l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.004</td>\n",
       "      <td>0.008</td>\n",
       "      <td>None</td>\n",
       "      <td>10</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>None</td>\n",
       "      <td>left</td>\n",
       "      <td>target3</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>61 rows  12 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "              crystal material active   xdim   ydim gap_R gap_L thick miscut  \\\n",
       "tcl.4l1.b2       None       cu   True      0      0  None  None     0      0   \n",
       "tcl.5l1.b2       None       cu   True      0      0  None  None     0      0   \n",
       "tcl.6l1.b2       None     iner   True      0      0  None  None     0      0   \n",
       "tctph.4r8.b2     None     iner   True      0      0  18.0  18.0     0      0   \n",
       "tctpv.4r8.b2     None     iner   True      0      0  18.0  18.0     0      0   \n",
       "...               ...      ...    ...    ...    ...   ...   ...   ...    ...   \n",
       "tctph.4r1.b2     None     iner   True      0      0  18.0  18.0     0      0   \n",
       "tctpv.4r1.b2     None     iner   True      0      0  18.0  18.0     0      0   \n",
       "tccs.5r3.b2     strip       si   True  0.002  0.035  None   5.0     0      0   \n",
       "tccp.4l3.b2     strip       si   True  0.002  0.008  None    10     0      0   \n",
       "target.4l3.b2    None     iner   True  0.004  0.008  None    10     0      0   \n",
       "\n",
       "               bend  side   family  \n",
       "tcl.4l1.b2     None  both     tcl4  \n",
       "tcl.5l1.b2     None  both     tcl5  \n",
       "tcl.6l1.b2     None  both     tcl6  \n",
       "tctph.4r8.b2   None  both     tct8  \n",
       "tctpv.4r8.b2   None  both     tct8  \n",
       "...             ...   ...      ...  \n",
       "tctph.4r1.b2   None  both    tct15  \n",
       "tctpv.4r1.b2   None  both    tct15  \n",
       "tccs.5r3.b2    80.0  left    tccs3  \n",
       "tccp.4l3.b2    10.0  left    tccp3  \n",
       "target.4l3.b2  None  left  target3  \n",
       "\n",
       "[61 rows x 12 columns]"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "colldb_test_Yaml._colldb[['crystal', 'material', 'active', 'xdim', 'ydim', 'gap_R', 'gap_L', 'thick', 'miscut', 'bend', 'side', 'family']]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'tcp3': {'parking': 0.025,\n",
       "  'gap': 15.0,\n",
       "  'stage': 'primary',\n",
       "  'material': 'C',\n",
       "  'length': 0.6},\n",
       " 'tcsg3': {'parking': 0.025,\n",
       "  'gap': 18.0,\n",
       "  'stage': 'secondary',\n",
       "  'material': 'C',\n",
       "  'length': 1},\n",
       " 'tcla3': {'parking': 0.025,\n",
       "  'gap': 20.0,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'Iner',\n",
       "  'length': 1},\n",
       " 'tcp7': {'parking': 0.025,\n",
       "  'gap': 5.0,\n",
       "  'stage': 'primary',\n",
       "  'material': 'C',\n",
       "  'length': 0.6},\n",
       " 'tcsg7': {'parking': 0.025,\n",
       "  'gap': 6.5,\n",
       "  'stage': 'secondary',\n",
       "  'material': 'C',\n",
       "  'length': 1},\n",
       " 'tcla7': {'parking': 0.025,\n",
       "  'gap': 10.0,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'Iner',\n",
       "  'length': 1},\n",
       " 'cry7': {'parking': 0.025,\n",
       "  'gap': None,\n",
       "  'stage': 'special',\n",
       "  'material': 'Si',\n",
       "  'length': 0.004,\n",
       "  'side': 'left',\n",
       "  'crystal': 'strip',\n",
       "  'active': False},\n",
       " 'tcli': {'parking': 0.025,\n",
       "  'gap': None,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'C',\n",
       "  'length': 1,\n",
       "  'angle': 90},\n",
       " 'tdi': {'parking': 0.025,\n",
       "  'gap': None,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'CU',\n",
       "  'length': 1.565,\n",
       "  'angle': 90},\n",
       " 'tcdq': {'parking': 0.025,\n",
       "  'gap': 7.3,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'C',\n",
       "  'length': 3,\n",
       "  'angle': 0,\n",
       "  'side': 'left'},\n",
       " 'tcsp': {'parking': 0.025,\n",
       "  'gap': 7.3,\n",
       "  'stage': 'secondary',\n",
       "  'material': 'C',\n",
       "  'length': 1,\n",
       "  'angle': 0},\n",
       " 'tct15': {'parking': 0.02,\n",
       "  'gap': 18.0,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'Iner',\n",
       "  'length': 1},\n",
       " 'tct2': {'parking': 0.025,\n",
       "  'gap': 37.0,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'Iner',\n",
       "  'length': 1},\n",
       " 'tct8': {'parking': 0.025,\n",
       "  'gap': 18.0,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'Iner',\n",
       "  'length': 1},\n",
       " 'tcl4': {'parking': 0.025,\n",
       "  'gap': None,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'CU',\n",
       "  'length': 1,\n",
       "  'angle': 0},\n",
       " 'tcl5': {'parking': 0.025,\n",
       "  'gap': None,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'CU',\n",
       "  'length': 1,\n",
       "  'angle': 0},\n",
       " 'tcl6': {'parking': 0.025,\n",
       "  'gap': None,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'Iner',\n",
       "  'length': 1,\n",
       "  'angle': 0},\n",
       " 'tcld': {'parking': 0.025,\n",
       "  'gap': None,\n",
       "  'stage': 'tertiary',\n",
       "  'material': 'Iner',\n",
       "  'length': 0.6,\n",
       "  'angle': 0},\n",
       " 'tccs3': {'parking': 0.025,\n",
       "  'gap': None,\n",
       "  'stage': 'special',\n",
       "  'material': 'Si',\n",
       "  'side': 'left',\n",
       "  'angle': 90,\n",
       "  'crystal': 'strip',\n",
       "  'active': True},\n",
       " 'tccp3': {'parking': 0.025,\n",
       "  'gap': None,\n",
       "  'stage': 'special',\n",
       "  'material': 'Si',\n",
       "  'side': 'left',\n",
       "  'angle': 90,\n",
       "  'crystal': 'strip',\n",
       "  'active': True},\n",
       " 'target3': {'parking': 0.025,\n",
       "  'gap': None,\n",
       "  'stage': 'special',\n",
       "  'material': 'Iner',\n",
       "  'side': 'left',\n",
       "  'angle': 90,\n",
       "  'active': True}}"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "colldb_test_Yaml._family_dict"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Patched line"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [],
   "source": [
    "def find_axis_intercepts(x_coords, y_coords):\n",
    "    x_intercepts = []\n",
    "    y_intercepts = []\n",
    "\n",
    "    for i in range(len(x_coords)):\n",
    "        x1, y1 = x_coords[i], y_coords[i]\n",
    "        x2, y2 = x_coords[(i + 1) % len(x_coords)], y_coords[(i + 1) % len(y_coords)]\n",
    "\n",
    "        if x1 == x2:\n",
    "        # Vertical line, no y-intercept\n",
    "            y_intercept = 0.0 if x1 == x2 == 0.0 else None\n",
    "        else:\n",
    "            slope = (y2 - y1) / (x2 - x1)\n",
    "            y_intercept = y1 - (slope * x1)\n",
    "\n",
    "        if y1 == y2:\n",
    "        # Horizontal line, no x-intercept\n",
    "            x_intercept = 0.0 if y1 == y2 == 0.0 else None\n",
    "        else:\n",
    "            slope = (x2 - x1) / (y2 - y1)\n",
    "            x_intercept = x1 - (slope * y1)\n",
    "\n",
    "        # Check if the x-intercept is within the range of x1 and x2\n",
    "        if x_intercept is not None and (x1 <= x_intercept <= x2 or x2 <= x_intercept <= x1):\n",
    "            x_intercepts.append(x_intercept)\n",
    "\n",
    "        # Check if the y-intercept is within the range of y1 and y2\n",
    "        if y_intercept is not None and (y1 <= y_intercept <= y2 or y2 <= y_intercept <= y1):\n",
    "            y_intercepts.append(y_intercept)\n",
    "\n",
    "    return x_intercepts, y_intercepts\n",
    "\n",
    "def find_bad_offset_apertures(line):\n",
    "    aperture_offsets = {}\n",
    "    for name, element in line.element_dict.items():\n",
    "        if 'offset' in name and element.__class__.__name__.startswith('XYShift'):\n",
    "            aper_name = name.split('_offset')[0]\n",
    "            aperture_offsets[aper_name] = (element.dx, element.dy)\n",
    "\n",
    "    bad_apers = {}\n",
    "    for ap_name, offset in aperture_offsets.items():\n",
    "        aperture_el = line.element_dict[ap_name]\n",
    "\n",
    "        cname= aperture_el.__class__.__name__\n",
    "        ap_dict = aperture_el.to_dict()\n",
    "\n",
    "        if cname == 'LimitEllipse':\n",
    "            x_min = -ap_dict['a']\n",
    "            x_max = ap_dict['a']\n",
    "            y_min = -ap_dict['b']\n",
    "            y_max = ap_dict['b']\n",
    "        elif cname == 'LimitRect':\n",
    "            x_min = ap_dict['min_x']\n",
    "            x_max = ap_dict['max_x']\n",
    "            y_min = ap_dict['min_y']\n",
    "            y_max = ap_dict['max_y']\n",
    "        elif cname == 'LimitRectEllipse':\n",
    "            x_min = -ap_dict['max_x']\n",
    "            x_max = ap_dict['max_x']\n",
    "            y_min = -ap_dict['max_y']\n",
    "            y_max = ap_dict['max_y']\n",
    "        elif cname == 'LimitRacetrack':\n",
    "            x_min = ap_dict['min_x']\n",
    "            x_max = ap_dict['max_x']\n",
    "            y_min = ap_dict['min_y']\n",
    "            y_max = ap_dict['max_y']\n",
    "        elif cname == 'LimitPolygon':\n",
    "            x_intercepts, y_intercepts = find_axis_intercepts(ap_dict['x_vertices'],\n",
    "                                                            ap_dict['y_vertices'])\n",
    "            x_min = min(x_intercepts)\n",
    "            x_max = max(x_intercepts)\n",
    "            y_min = min(y_intercepts)\n",
    "            y_max = max(y_intercepts)\n",
    "\n",
    "        tolerance = 5e-3\n",
    "        \"\"\"if (x_max - offset[0] < tolerance \n",
    "            or -x_min + offset[0] < tolerance \n",
    "            or y_max - offset[1] < tolerance \n",
    "            or -y_min + offset[1] < tolerance):\"\"\"\n",
    "        if (offset[0] -x_max > tolerance \n",
    "            or  -offset[0] + x_min > tolerance \n",
    "            or  offset[1] - y_max > tolerance \n",
    "            or  -offset[1] + y_min > tolerance ):\n",
    "                bad_apers[ap_name] = (x_min, x_max, y_min, y_max, offset[0], offset[1])\n",
    "\n",
    "    return bad_apers\n",
    "\n",
    "def load_line(line_name, coll_file, particle_ref):\n",
    "    if coll_file.endswith('.yaml'):\n",
    "        with open(coll_file, 'r') as stream:\n",
    "            coll_dict = yaml.safe_load(stream)['collimators'][f'b{beam}']\n",
    "    if coll_file.endswith('.data'):\n",
    "        coll_dict = load_colldb_new(coll_file).to_dict('index')\n",
    "\n",
    "\n",
    "    # Load from json\n",
    "    line = xt.Line.from_json(line_name)\n",
    "    line.particle_ref = particle_ref\n",
    "\n",
    "    end_s = line.get_length()\n",
    "\n",
    "    TCCS_loc = end_s - 6773.7 #6775\n",
    "    TCCP_loc = end_s - 6653.3 #6655\n",
    "    TARGET_loc = end_s - (6653.3 + coll_dict[TCCP_name][\"length\"]/2 + coll_dict[TARGET_name][\"length\"]/2)\n",
    "\n",
    "    line.insert_element(at_s=TCCS_loc, element=xt.Marker(), name='tccs.5r3.b2')\n",
    "    line.insert_element(at_s=TCCS_loc, element=xt.LimitEllipse(a_squ=0.0016, b_squ=0.0016, a_b_squ=2.56e-06), name='tccs.5r3.b2_aper')\n",
    "    line.insert_element(at_s=TCCP_loc, element=xt.Marker(), name='tccp.4l3.b2')\n",
    "    line.insert_element(at_s=TCCP_loc, element=xt.LimitEllipse(a_squ=0.0016, b_squ=0.0016, a_b_squ=2.56e-06), name='tccp.4l3.b2_aper')\n",
    "    line.insert_element(at_s=TARGET_loc, element=xt.Marker(), name='target.4l3.b2')\n",
    "    line.insert_element(at_s=TARGET_loc, element=xt.LimitEllipse(a_squ=0.0016, b_squ=0.0016, a_b_squ=2.56e-06), name='target.4l3.b2_aper')\n",
    "\n",
    "\n",
    "    bad_aper = find_bad_offset_apertures(line)\n",
    "    print('Bad apertures : ', bad_aper)\n",
    "    print('Replace bad apertures with Marker')\n",
    "    for name in bad_aper.keys():\n",
    "        line.element_dict[name] = xt.Marker()\n",
    "        print(name, line.get_s_position(name), line.element_dict[name])\n",
    "\n",
    "    speed = line.particle_ref._xobject.beta0[0]*scipy.constants.c\n",
    "    harmonic_number = 35640\n",
    "    voltage = 12e6/len(line.get_elements_of_type(xt.Cavity)[1])\n",
    "    frequency = harmonic_number * speed /line.get_length()\n",
    "\n",
    "    for side in ['l', 'r']:\n",
    "        for cell in ['a','b','c','d']:\n",
    "            line[f'acsca.{cell}5{side}4.b2'].voltage = voltage\n",
    "            line[f'acsca.{cell}5{side}4.b2'].frequency = frequency\n",
    "\n",
    "    return line"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [],
   "source": [
    "#line_name_HL_IR7_patched = os.path.expandvars(\"${HOME_TWOCRYST}/input_files/HL_IR7_rematched/b4_sequence_patched.json\")\n",
    "#line_name_HL_IR7_IR3_patched = os.path.expandvars(\"${HOME_TWOCRYST}/input_files/HL_IR7_IR3_rematched/b4_sequence_patched.json\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Done loading line from dict.           \n",
      "Bad apertures :  {}\n",
      "Replace bad apertures with Marker\n"
     ]
    }
   ],
   "source": [
    "#line = load_line(line_name_HL_IR7_IR3, coll_file_HL, particle_ref_HL)\n",
    "line = load_line(line_name_HL_IR7, coll_file_HL, particle_ref_HL)\n",
    "#line = load_line(line_name_RUN3, coll_file_RUN3, particle_ref_RUN3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "Aperture model check on imported model:\n",
      "Done checking aperture.           \n",
      "0 thin elements miss associated aperture (upstream):\n",
      "[]\n",
      "0 thick elements miss associated aperture (upstream or downstream):\n",
      "[]\n"
     ]
    }
   ],
   "source": [
    "# Aperture model check\n",
    "print('\\nAperture model check on imported model:')\n",
    "df_imported = line.check_aperture()\n",
    "assert not np.any(df_imported.has_aperture_problem)\n",
    "\n",
    "\n",
    "# Initialise collmanager\n",
    "coll_manager = xc.CollimatorManager.from_SixTrack(coll_file_HL, line=line, _context=context, ignore_crystals=False, nemitt_x = 2.5e-6,  nemitt_y = 2.5e-6)\n",
    "#coll_manager = xc.CollimatorManager.from_yaml(coll_file_RUN3, line=line, beam=2, _context=context, ignore_crystals=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>crystal</th>\n",
       "      <th>material</th>\n",
       "      <th>active</th>\n",
       "      <th>xdim</th>\n",
       "      <th>ydim</th>\n",
       "      <th>gap_R</th>\n",
       "      <th>gap_L</th>\n",
       "      <th>thick</th>\n",
       "      <th>miscut</th>\n",
       "      <th>bend</th>\n",
       "      <th>side</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>tclpx.4l1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcl.5l1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcl.6l1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctph.4r2.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>43.8</td>\n",
       "      <td>43.8</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpv.4r2.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>43.8</td>\n",
       "      <td>43.8</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tdisa.a4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tdisb.a4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tdisc.a4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tclia.4r2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tclib.6l8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcld.a11l2.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcp.6r3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>17.7</td>\n",
       "      <td>17.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.5r3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>21.3</td>\n",
       "      <td>21.3</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.4l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>21.3</td>\n",
       "      <td>21.3</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.a5l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>21.3</td>\n",
       "      <td>21.3</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.b5l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>21.3</td>\n",
       "      <td>21.3</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.a5l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23.7</td>\n",
       "      <td>23.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.b5l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23.7</td>\n",
       "      <td>23.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.6l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23.7</td>\n",
       "      <td>23.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.7l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23.7</td>\n",
       "      <td>23.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctph.6r5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpv.6r5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpxh.4r5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpxv.4r5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tclpx.4l5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcl.5l5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>cu</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcl.6l5.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.4</td>\n",
       "      <td>16.4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcdqa.a4l6.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>10.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>left</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcdqa.c4l6.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>10.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>left</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcdqa.b4l6.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>10.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>left</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsp.a4l6.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>10.1</td>\n",
       "      <td>10.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcp.d6r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>6.7</td>\n",
       "      <td>6.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcp.c6r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>6.7</td>\n",
       "      <td>6.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcp.b6r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>6.7</td>\n",
       "      <td>6.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.a6r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.b5r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.a5r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>c</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.d4r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcspm.b4r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.a4r7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.a4l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.b5l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcsg.d5l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcspm.e5l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcspm.6l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>mogr</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>9.1</td>\n",
       "      <td>9.1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.a6l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.7</td>\n",
       "      <td>12.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.b6l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.7</td>\n",
       "      <td>12.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.c6l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.7</td>\n",
       "      <td>12.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.d6l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.7</td>\n",
       "      <td>12.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcla.a7l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.7</td>\n",
       "      <td>12.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tcld.9l7.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctph.4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>17.7</td>\n",
       "      <td>17.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpv.4r8.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>17.7</td>\n",
       "      <td>17.7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctph.6r1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpv.6r1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpxh.4r1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tctpxv.4r1.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>both</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tccs.5r3.b2</th>\n",
       "      <td>strip</td>\n",
       "      <td>si</td>\n",
       "      <td>True</td>\n",
       "      <td>0.002</td>\n",
       "      <td>0.035</td>\n",
       "      <td>None</td>\n",
       "      <td>7.2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>80.0</td>\n",
       "      <td>left</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>tccp.4l3.b2</th>\n",
       "      <td>strip</td>\n",
       "      <td>si</td>\n",
       "      <td>True</td>\n",
       "      <td>0.002</td>\n",
       "      <td>0.004</td>\n",
       "      <td>None</td>\n",
       "      <td>15.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>left</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>target.4l3.b2</th>\n",
       "      <td>None</td>\n",
       "      <td>iner</td>\n",
       "      <td>True</td>\n",
       "      <td>0.002</td>\n",
       "      <td>0.004</td>\n",
       "      <td>None</td>\n",
       "      <td>15.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>left</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              crystal material active   xdim   ydim gap_R gap_L thick miscut  \\\n",
       "tclpx.4l1.b2     None     iner   True    0.0    0.0  16.4  16.4   0.0    0.0   \n",
       "tcl.5l1.b2       None       cu   True    0.0    0.0  16.4  16.4   0.0    0.0   \n",
       "tcl.6l1.b2       None     iner   True    0.0    0.0  16.4  16.4   0.0    0.0   \n",
       "tctph.4r2.b2     None     iner   True    0.0    0.0  43.8  43.8   0.0    0.0   \n",
       "tctpv.4r2.b2     None     iner   True    0.0    0.0  43.8  43.8   0.0    0.0   \n",
       "tdisa.a4r8.b2    None       cu   True    0.0    0.0  None  None   0.0    0.0   \n",
       "tdisb.a4r8.b2    None       cu   True    0.0    0.0  None  None   0.0    0.0   \n",
       "tdisc.a4r8.b2    None       cu   True    0.0    0.0  None  None   0.0    0.0   \n",
       "tclia.4r2        None        c   True    0.0    0.0  None  None   0.0    0.0   \n",
       "tclib.6l8.b2     None        c   True    0.0    0.0  None  None   0.0    0.0   \n",
       "tcld.a11l2.b2    None     iner   True    0.0    0.0  None  None   0.0    0.0   \n",
       "tcp.6r3.b2       None        c   True    0.0    0.0  17.7  17.7   0.0    0.0   \n",
       "tcsg.5r3.b2      None        c   True    0.0    0.0  21.3  21.3   0.0    0.0   \n",
       "tcsg.4l3.b2      None        c   True    0.0    0.0  21.3  21.3   0.0    0.0   \n",
       "tcsg.a5l3.b2     None        c   True    0.0    0.0  21.3  21.3   0.0    0.0   \n",
       "tcsg.b5l3.b2     None        c   True    0.0    0.0  21.3  21.3   0.0    0.0   \n",
       "tcla.a5l3.b2     None     iner   True    0.0    0.0  23.7  23.7   0.0    0.0   \n",
       "tcla.b5l3.b2     None     iner   True    0.0    0.0  23.7  23.7   0.0    0.0   \n",
       "tcla.6l3.b2      None     iner   True    0.0    0.0  23.7  23.7   0.0    0.0   \n",
       "tcla.7l3.b2      None     iner   True    0.0    0.0  23.7  23.7   0.0    0.0   \n",
       "tctph.6r5.b2     None     iner   True    0.0    0.0  12.0  12.0   0.0    0.0   \n",
       "tctpv.6r5.b2     None     iner   True    0.0    0.0  12.0  12.0   0.0    0.0   \n",
       "tctpxh.4r5.b2    None     iner   True    0.0    0.0  12.0  12.0   0.0    0.0   \n",
       "tctpxv.4r5.b2    None     iner   True    0.0    0.0  12.0  12.0   0.0    0.0   \n",
       "tclpx.4l5.b2     None     iner   True    0.0    0.0  16.4  16.4   0.0    0.0   \n",
       "tcl.5l5.b2       None       cu   True    0.0    0.0  16.4  16.4   0.0    0.0   \n",
       "tcl.6l5.b2       None     iner   True    0.0    0.0  16.4  16.4   0.0    0.0   \n",
       "tcdqa.a4l6.b2    None        c   True    0.0    0.0  None  10.1   0.0    0.0   \n",
       "tcdqa.c4l6.b2    None        c   True    0.0    0.0  None  10.1   0.0    0.0   \n",
       "tcdqa.b4l6.b2    None        c   True    0.0    0.0  None  10.1   0.0    0.0   \n",
       "tcsp.a4l6.b2     None        c   True    0.0    0.0  10.1  10.1   0.0    0.0   \n",
       "tcp.d6r7.b2      None     mogr   True    0.0    0.0   6.7   6.7   0.0    0.0   \n",
       "tcp.c6r7.b2      None     mogr   True    0.0    0.0   6.7   6.7   0.0    0.0   \n",
       "tcp.b6r7.b2      None        c   True    0.0    0.0   6.7   6.7   0.0    0.0   \n",
       "tcsg.a6r7.b2     None        c   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcsg.b5r7.b2     None     mogr   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcsg.a5r7.b2     None        c   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcsg.d4r7.b2     None     mogr   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcspm.b4r7.b2    None     mogr   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcsg.a4r7.b2     None     mogr   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcsg.a4l7.b2     None     mogr   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcsg.b5l7.b2     None     mogr   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcsg.d5l7.b2     None     mogr   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcspm.e5l7.b2    None     mogr   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcspm.6l7.b2     None     mogr   True    0.0    0.0   9.1   9.1   0.0    0.0   \n",
       "tcla.a6l7.b2     None     iner   True    0.0    0.0  12.7  12.7   0.0    0.0   \n",
       "tcla.b6l7.b2     None     iner   True    0.0    0.0  12.7  12.7   0.0    0.0   \n",
       "tcla.c6l7.b2     None     iner   True    0.0    0.0  12.7  12.7   0.0    0.0   \n",
       "tcla.d6l7.b2     None     iner   True    0.0    0.0  12.7  12.7   0.0    0.0   \n",
       "tcla.a7l7.b2     None     iner   True    0.0    0.0  12.7  12.7   0.0    0.0   \n",
       "tcld.9l7.b2      None     iner   True    0.0    0.0  None  None   0.0    0.0   \n",
       "tctph.4r8.b2     None     iner   True    0.0    0.0  17.7  17.7   0.0    0.0   \n",
       "tctpv.4r8.b2     None     iner   True    0.0    0.0  17.7  17.7   0.0    0.0   \n",
       "tctph.6r1.b2     None     iner   True    0.0    0.0  12.0  12.0   0.0    0.0   \n",
       "tctpv.6r1.b2     None     iner   True    0.0    0.0  12.0  12.0   0.0    0.0   \n",
       "tctpxh.4r1.b2    None     iner   True    0.0    0.0  12.0  12.0   0.0    0.0   \n",
       "tctpxv.4r1.b2    None     iner   True    0.0    0.0  12.0  12.0   0.0    0.0   \n",
       "tccs.5r3.b2     strip       si   True  0.002  0.035  None   7.2   0.0    0.0   \n",
       "tccp.4l3.b2     strip       si   True  0.002  0.004  None  15.0   0.0    0.0   \n",
       "target.4l3.b2    None     iner   True  0.002  0.004  None  15.0   0.0    0.0   \n",
       "\n",
       "               bend  side  \n",
       "tclpx.4l1.b2    0.0  both  \n",
       "tcl.5l1.b2      0.0  both  \n",
       "tcl.6l1.b2      0.0  both  \n",
       "tctph.4r2.b2    0.0  both  \n",
       "tctpv.4r2.b2    0.0  both  \n",
       "tdisa.a4r8.b2   0.0  both  \n",
       "tdisb.a4r8.b2   0.0  both  \n",
       "tdisc.a4r8.b2   0.0  both  \n",
       "tclia.4r2       0.0  both  \n",
       "tclib.6l8.b2    0.0  both  \n",
       "tcld.a11l2.b2   0.0  both  \n",
       "tcp.6r3.b2      0.0  both  \n",
       "tcsg.5r3.b2     0.0  both  \n",
       "tcsg.4l3.b2     0.0  both  \n",
       "tcsg.a5l3.b2    0.0  both  \n",
       "tcsg.b5l3.b2    0.0  both  \n",
       "tcla.a5l3.b2    0.0  both  \n",
       "tcla.b5l3.b2    0.0  both  \n",
       "tcla.6l3.b2     0.0  both  \n",
       "tcla.7l3.b2     0.0  both  \n",
       "tctph.6r5.b2    0.0  both  \n",
       "tctpv.6r5.b2    0.0  both  \n",
       "tctpxh.4r5.b2   0.0  both  \n",
       "tctpxv.4r5.b2   0.0  both  \n",
       "tclpx.4l5.b2    0.0  both  \n",
       "tcl.5l5.b2      0.0  both  \n",
       "tcl.6l5.b2      0.0  both  \n",
       "tcdqa.a4l6.b2   0.0  left  \n",
       "tcdqa.c4l6.b2   0.0  left  \n",
       "tcdqa.b4l6.b2   0.0  left  \n",
       "tcsp.a4l6.b2    0.0  both  \n",
       "tcp.d6r7.b2     0.0  both  \n",
       "tcp.c6r7.b2     0.0  both  \n",
       "tcp.b6r7.b2     0.0  both  \n",
       "tcsg.a6r7.b2    0.0  both  \n",
       "tcsg.b5r7.b2    0.0  both  \n",
       "tcsg.a5r7.b2    0.0  both  \n",
       "tcsg.d4r7.b2    0.0  both  \n",
       "tcspm.b4r7.b2   0.0  both  \n",
       "tcsg.a4r7.b2    0.0  both  \n",
       "tcsg.a4l7.b2    0.0  both  \n",
       "tcsg.b5l7.b2    0.0  both  \n",
       "tcsg.d5l7.b2    0.0  both  \n",
       "tcspm.e5l7.b2   0.0  both  \n",
       "tcspm.6l7.b2    0.0  both  \n",
       "tcla.a6l7.b2    0.0  both  \n",
       "tcla.b6l7.b2    0.0  both  \n",
       "tcla.c6l7.b2    0.0  both  \n",
       "tcla.d6l7.b2    0.0  both  \n",
       "tcla.a7l7.b2    0.0  both  \n",
       "tcld.9l7.b2     0.0  both  \n",
       "tctph.4r8.b2    0.0  both  \n",
       "tctpv.4r8.b2    0.0  both  \n",
       "tctph.6r1.b2    0.0  both  \n",
       "tctpv.6r1.b2    0.0  both  \n",
       "tctpxh.4r1.b2   0.0  both  \n",
       "tctpxv.4r1.b2   0.0  both  \n",
       "tccs.5r3.b2    80.0  left  \n",
       "tccp.4l3.b2    10.0  left  \n",
       "target.4l3.b2   0.0  left  "
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "coll_manager.colldb._colldb[['crystal', 'material', 'active', 'xdim', 'ydim', 'gap_R', 'gap_L', 'thick', 'miscut', 'bend', 'side']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Compiling ContextCpu kernels...\n",
      "Done compiling ContextCpu kernels.\n"
     ]
    }
   ],
   "source": [
    "coll_names = coll_manager.collimator_names\n",
    "# black_absorbers = []\n",
    "# everest_colls = [name for name in coll_names if name not in black_absorbers]\n",
    "# coll_manager.install_everest_collimators(names=everest_colls,verbose=True)\n",
    "coll_manager.install_everest_collimators()\n",
    "# coll_manager.install_black_absorbers(names = black_absorbers, verbose=True)\n",
    "\n",
    "\n",
    "\n",
    "# Aperture model check\n",
    "print('\\nAperture model check after introducing collimators:')\n",
    "df_with_coll = line.check_aperture()\n",
    "assert not np.any(df_with_coll.has_aperture_problem)\n",
    "\n",
    "    \n",
    "# Build the tracker\n",
    "coll_manager.build_tracker()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "# line.twiss(method='4d')\n",
    "\n",
    "# Set the collimator openings based on the colldb,\n",
    "# or manually override with the option gaps={collname: gap}\n",
    "coll_manager.set_openings()\n",
    "\n",
    "# Aperture model check\n",
    "print('\\nAperture model check after introducing collimators:')\n",
    "df_with_coll = line.check_aperture()\n",
    "assert not np.any(df_with_coll.has_aperture_problem)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "plane = \"V\"\n",
    "beam = 2\n",
    "num_particles = 5\n",
    "num_turns = 2\n",
    "# Generate initial pencil distribution on horizontal collimator\n",
    "tcp  = f\"tcp.{'c' if plane=='H' else 'd'}6{'l' if beam=='1' else 'r'}7.b{beam}\"\n",
    "part = coll_manager.generate_pencil_on_collimator(tcp, num_particles=num_particles)\n",
    "\n",
    "\n",
    "# Optimise the line\n",
    "#line.optimize_for_tracking()\n",
    "idx = line.element_names.index(tcp)\n",
    "part.at_element = idx\n",
    "part.start_tracking_at_element = idx\n",
    "\n",
    "\n",
    "# Track\n",
    "coll_manager.enable_scattering()\n",
    "line.track(part, num_turns=num_turns, time=True)\n",
    "coll_manager.disable_scattering()\n",
    "print(f\"Done tracking in {line.time_last_track:.1f}s.\")\n",
    "\n",
    "\n",
    "# Save lossmap to json, which can be loaded, combined (for more statistics),\n",
    "# and plotted with the 'lossmaps' package\n",
    "_ = coll_manager.lossmap(part)\n",
    "\n",
    "\n",
    "\n",
    "# Save a summary of the collimator losses to a text file\n",
    "summary = coll_manager.summary(part) #, file=Path(path_out,f'coll_summary_B{beam}{plane}.out')\n",
    "print(summary)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "@webio": {
   "lastCommId": null,
   "lastKernelId": null
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
